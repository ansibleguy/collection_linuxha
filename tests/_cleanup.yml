---

- name: Cleanup
  hosts: node1
  gather_facts: no
  become: true
  vars_files:
    - "{{ lookup('ansible.builtin.env', 'TEST_SECRETS') }}"

  tasks:
    - name: Stopping resources
      ansibleguy.linuxha.raw:
        cmd: "resource stop {{ item }}"
        wait: true
      register: cl_res1
      failed_when:
        - cl_res1.failed
        - "'Resource not found' not in cl_res1.stderr"
      loop:
        - 'ANSIBLE_TEST_1_1'
        - 'ANSIBLE_TEST_2_1'

    - name: Deleting dummy resource
      ansibleguy.linuxha.raw:
        cmd: "configure delete {{ item }}"
        wait: true
        force: true
      register: cl_res2
      failed_when:
        - cl_res2.failed
        - "'Resource not found' not in cl_res2.stderr"
      loop:
        - 'ANSIBLE_TEST_1_1'
        - 'ANSIBLE_TEST_2_1'
